# 规范解析

## 查找规范

在解析之前，定位规范页面：

```
1. 搜索规范：
   Notion:notion-search
   query: "[功能名称] 规范"或"[功能名称] specification"
   
2. 处理结果：
   - 如果找到 → 使用页面 URL/ID
   - 如果有多个 → 询问用户哪一个
   - 如果未找到 → 询问用户 URL/ID

示例：
Notion:notion-search
query: "用户配置文件 API 规范"
query_type: "internal"
```

## 读取规范

找到规范后，使用 `Notion:notion-fetch` 获取它：

1. 读取完整内容
2. 识别关键章节
3. 提取结构化信息
4. 注意歧义或空白

```
Notion:notion-fetch
id: "spec-page-id-from-search"
```

## 常见规范结构

### 基于需求的规范

```
# 功能规范
## 概述
[功能描述]

## 需求
### 功能需求
- REQ-1：[需求]
- REQ-2：[需求]

### 非功能需求
- PERF-1：[性能需求]
- SEC-1：[安全需求]

## 验收标准
- AC-1：[标准]
- AC-2：[标准]
```

提取：
- 功能需求列表
- 非功能需求列表
- 验收标准列表

### 基于用户故事的规范

```
# 功能规范
## 用户故事
### 作为 [用户类型]
我想要 [目标]
以便 [利益]

**验收标准**：
- [标准]
- [标准]
```

提取：
- 用户角色
- 需要的目标/能力
- 每个故事的验收标准

### 技术设计文档

```
# 技术设计
## 问题陈述
[问题描述]

## 提议的解决方案
[解决方案方法]

## 架构
[架构详细信息]

## 实施计划
[实施方法]
```

提取：
- 要解决的问题
- 提议的解决方案方法
- 架构决策
- 实施指导

### 产品需求文档（PRD）

```
# PRD：[功能]
## 目标
[业务目标]

## 用户需求
[正在解决的用户问题]

## 功能
[功能列表]

## 成功指标
[如何衡量成功]
```

提取：
- 业务目标
- 用户需求
- 功能列表
- 成功指标

## 提取策略

### 需求识别

查找：
- "必须"、"应该"、"将"等陈述
- 编号的需求（REQ-1 等）
- 用户故事（作为...我想要...）
- 验收标准章节
- 功能列表

### 分类

按以下方式对需求进行分组：

**功能需求**：系统做什么
- 用户能力
- 系统行为
- 数据操作

**非功能需求**：系统如何执行
- 性能目标
- 安全要求
- 可扩展性需求
- 可用性要求
- 合规性要求

**约束**：限制
- 技术约束
- 业务约束
- 时间线约束

### 优先级提取

识别优先级指示器：
- "关键"、"必须有"、"P0"
- "重要"、"应该有"、"P1"
- "最好有"、"可以有"、"P2"
- "未来"、"不会有"、"P3"

根据优先级映射到实施阶段。

## 处理歧义

### 不明确的需求

当需求不明确时：

```markdown
## 需要澄清

### [需求 ID/描述]
**当前文本**："[不明确的需求]"
**问题**：[需要澄清的内容]
**影响**：[这对实施为何重要]
**当前假设**：[如果有，工作假设]
```

创建澄清任务或向规范添加评论。

### 缺失信息

当关键信息缺失时：

```markdown
## 缺失信息

- **[主题]**：规范未指定[缺失的内容]
- **影响**：阻塞[受影响的任务]
- **行动**：需要[如何解决]
```

### 冲突的需求

当需求冲突时：

```markdown
## 冲突的需求

**冲突**：REQ-1 说 [X] 但 REQ-5 说 [Y]
**影响**：[实施影响]
**需要解决方案**：[需要决策]
```

## 验收标准解析

### 明确的标准

直接的验收标准：

```
## 验收标准
- 用户可以使用电子邮件和密码登录
- 系统发送确认电子邮件
- 会话在 24 小时后过期
```

转换为清单：
- [ ] 用户可以使用电子邮件和密码登录
- [ ] 系统发送确认电子邮件
- [ ] 会话在 24 小时后过期

### 隐含的标准

从需求推导：

```
需求："用户可以上传最大 100MB 的文件"

隐含的验收标准：
- [ ] 最大 100MB 的文件成功上传
- [ ] 超过 100MB 的文件被拒绝并显示错误消息
- [ ] 上传期间显示进度指示器
- [ ] 上传可以取消
```

### 可测试的标准

确保标准是可测试的：

❌ **不可测试**："系统很快"
✓ **可测试**："页面在 < 2 秒内加载"

❌ **不可测试**："用户喜欢界面"
✓ **可测试**："90% 的测试用户成功完成任务"

## 技术细节提取

### 架构信息

提取：
- 系统组件
- 数据模型
- API/接口
- 集成点
- 技术选择

### 设计决策

注意：
- 技术选择
- 架构模式
- 做出的权衡
- 提供的理由

### 实施指导

查找：
- 建议的方法
- 代码示例
- 库推荐
- 提到的最佳实践

## 依赖关系识别

### 外部依赖

从规范中识别：
- 需要的第三方服务
- 需要的外部 API
- 基础设施要求
- 工具/库依赖

### 内部依赖

识别：
- 首先需要的其他功能
- 需要的共享组件
- 团队依赖
- 数据依赖

### 时间线依赖

注意：
- 硬性截止日期
- 里程碑依赖
- 排序需求

## 范围提取

### 范围内

明确包含的内容：
- 要构建的功能
- 要支持的用例
- 要服务的用户/角色

### 范围外

明确排除的内容：
- 延期的功能
- 不支持的用例
- 未处理的边缘情况

### 假设

假设的内容：
- 环境假设
- 用户假设
- 系统状态假设

## 风险识别

提取风险信息：

### 技术风险
- 未经验证的技术
- 复杂的集成
- 性能问题
- 可扩展性未知

### 业务风险
- 市场时机
- 资源可用性
- 对他人的依赖

### 缓解策略

注意规范中提到的任何缓解方法。

## 规范质量评估

评估规范的完整性：

✓ **良好的规范**：
- 清晰的需求
- 明确的验收标准
- 定义的优先级
- 识别的风险
- 概述的技术方法

⚠️ **不完整的规范**：
- 模糊的需求
- 缺失的验收标准
- 不明确的优先级
- 无风险分析
- 缺少技术细节

记录空白并创建澄清任务。

## 解析清单

在创建实施计划之前：

☐ 识别所有功能需求
☐ 注意非功能需求
☐ 提取验收标准
☐ 识别依赖关系
☐ 注意风险
☐ 记录歧义
☐ 理解技术方法
☐ 范围清晰
☐ 定义优先级
